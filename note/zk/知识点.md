## 分布式协调服务
- 不要把zookeeper当数据库使用
- 不可用状态恢复到可用状态，选取新的leader（200ms）
- 统一配置管理 1M数据
- 分组管理 path结构
- 统一命名 sequential
- 同步 临时节点
- 分布式锁 临时节点
- HA 选主
#### 特征/保障
1. 顺序性（增删改都发给Leader节点）
2. 原子性
3. 统一视图
4. 可靠性
5. 及时性
6. 最终一致性
#### 目录树结构
Znode 可以存1MB数据。数据存放在内存中。
- 持久节点
- 临时节点
1. 客户端连接会建立一个session  
**如果客户端连接的服务端挂了，会重新连接到其他服务端。sessionId不会变**
- 有序节点
#### 角色
- leader 选举 超过半数 接受增删改的请求 发起proposal（Follower和Leader进行投票 超过半数commit确认成功）
- follower
- observer
扩大查询能力。不能参与选举。
#### ZAB 原子广播协议
- Paxos 算法
数据状态在内存，日志写在磁盘。每个follower和leader之间有一个队列。两阶段提交。
#### 分布式锁
1. 争抢锁 只有一个人能获得锁
2. 获得锁的人出问题 临时节点（session）
3. 获得锁的人成功了 释放锁
4. 锁被释放、删除、别人怎么知道的


- 集群为什么奇数好：偶数也可以！从容错角度和偶数是一样的，可以少一台。奇数可以防脑裂。
- 为什么要过半数：选leader和更新操作。容错。全部更完美，提高效率。
- Watcher 注册一个只会通知一次。
- 数据据保存在内存 定期落地磁盘
- zookeeper 恢复模式-选主 广播模式（Zab 原子广播）
- ZNode 临时和持久化